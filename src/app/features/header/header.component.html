<div class="header-container">
  <div class="header-left">
    @if (pageTitleService.getBackButtonVisibility()) {
    <div class="header-item" (click)="goBack()">
      <img src="arrow-left-gray.svg" alt="arrow left" />
    </div>
    }
    <h1 class="page-title">{{ pageTitle }}</h1>
  </div>

  <div class="header-right">
    <!-- Dropdown with overlay icon -->
    <div class="header-item">
      <p-overlayPanel
        #filterPanel
        [showCloseIcon]="false"
        [dismissable]="true"
        styleClass="filter-overlay"
      >
        <div class="filter-overlay-content">
          <!-- Header with title and close button -->
          <div class="filter-overlay-header">
            <h3 class="filter-overlay-title">Choose properties</h3>
            <button class="filter-overlay-close" (click)="filterPanel.hide()">
              <img src="icon-green-close.svg" alt="close" />
            </button>
          </div>

          <!-- Divider -->
          <div class="filter-divider"></div>

          <!-- Filter sections -->
          <div class="filter-sections">
            @for (section of filterSections; track section.name) {
            <div class="filter-section">
              <div
                class="filter-section-header"
                (click)="toggleFilterSection(section)"
              >
                <span class="filter-section-title">{{ section.name }}</span>
                <img
                  [src]="
                    section.expanded
                      ? 'arrow-green-up.svg'
                      : 'arrow-green-down.svg'
                  "
                  alt="arrow"
                />
              </div>

              @if (section.expanded) {
              <div class="filter-section-content">
                @for (option of section.options; track option.isSelected) {
                <div class="filter-option">
                  <div
                    class="custom-checkbox"
                    [class.selected]="section.selectedOption === option.isSelected"
                    (click)="selectOption(section, option.isSelected)"
                  >
                    <img 
                      [src]="section.selectedOption == option.isSelected ?  'icon-tick.svg' : 'icon-tick-empty.svg'"
                    />
                  </div>
                  <label
                    class="filter-option-label"
                    (click)="selectOption(section, option.isSelected)"
                  >
                    {{ option.name }}
                  </label>
                </div>
                }
              </div>
              }

              <!-- Divider after each section -->
              <div class="filter-divider"></div>
            </div>
            }
          </div>

          <!-- Filter actions -->
          <div class="filter-actions">
            <button
              type="button"
              class="filter-btn filter-btn-clear"
              (click)="clearAllFilters()"
            >
              Clear All
            </button>
            <button
              type="button"
              class="filter-btn filter-btn-apply"
              (click)="applyFilters()"
            >
              Apply
            </button>
          </div>
        </div>
      </p-overlayPanel>

      <button
        pButton
        type="button"
        class="p-button-text filter-button"
        (click)="filterPanel.toggle($event)"
      >
        <span class="button-label">{{ selectedFiltersText }}</span>
        <img
          src="arrow-green-down.svg"
          alt="filter icon"
          class="custom-filter-icon"
        />
      </button>
    </div>

    <!-- Notification icon -->
    <div class="header-item notification-icon">
      <img src="icon-bell.svg" alt="bell" />
    </div>

    <!-- User profile -->
    <div class="header-item user-profile">
      <p-menu #userMenu [model]="userMenuItems" [popup]="true"></p-menu>

      <div class="user-info" (click)="userMenu.toggle($event)">
        <div class="user-avatar">
          <span class="user-initials">{{ userInitials }}</span>
        </div>
        <div class="user-details">
          <span class="user-name">{{ userName }}</span>
          <span class="user-role">{{ userRole }}</span>
        </div>
        <i class="pi pi-chevron-down"></i>
      </div>
    </div>
  </div>
</div>
